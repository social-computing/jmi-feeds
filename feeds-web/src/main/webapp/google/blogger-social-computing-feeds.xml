<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Just Map It! Feeds" title_url="http://feeds.just-map-it.com/" width="300" height="300" 
	  	author="Social Computing" author_email="mapyourfeeds@social-computing.com" author_link="http://www.social-computing.com"
		description="Just Map It! Feeds lets you view and navigate your posts thru an interactive map! by Social Computing" 
		screenshot="http://feeds.just-map-it.com/images/screenshot.png" 
		thumbnail="http://feeds.just-map-it.com/images/thumbnail.png">
    <Icon>http://www.social-computing.com/favicon.ico</Icon>
	<Require feature="google.blog"/>
    <Require feature="flash" />
  </ModulePrefs>
  <Content type="html" view="home,profile,canvas">
<![CDATA[
<div id='wps-feeds' style="width:100%;height:100%;"></div>
<script type="text/javascript" language="javascript"> 
  
  var viewFeeds = new google.Blog(getFeedUrl, window.name); 
  
  function getFeedUrl() {
	 var flashvars = {};
	 JMIF_CompleteParameters( flashvars);
	 flashvars.analysisProfile = "GlobalProfile";
	 flashvars.feed = viewFeeds.getPostsFeedUrl();
	 
	   var parameters = gadgets.views ? gadgets.views.getParams() : null;
	   if( parameters) {
	    	for (var prop in parameters) {
	    		flashvars[prop] = parameters[prop];
	   		}
	   }
	   var fv='';
	   for (var prop in flashvars) {
	      if (fv) fv=fv+'&';
	      fv=fv + prop + '=' + flashvars[prop];
	   }
	   var params= {
			bgcolor: "fff", allowFullScreen: "true", allowscriptaccess: "always",
	        allowNetworking: "all", quality: "high", menu: "true", wmode: "opaque",
	        flashvars: fv
	   };
	   gadgets.flash.embedFlash('http://feeds.just-map-it.com/jmi-client/swf/jmi-flex-1.0-SNAPSHOT.swf', 'wps-feeds', 10, params);
  }

  function getMap() {
  	 return document.getElementById('wps-feeds').childNodes[0];
  }
    
  function JMIF_empty() {
 	 alert( "Sorry, the map is empty. Does the feed contains categories?");
  }
  function JMIF_ready() {
   // do something here
  }
  function JMIF_error( error) {
   	alert( "Sorry, an error occured. Is this URL correct? " + error);
  }
  function JMIF_Navigate( url) {
 	 window.open( url, "_blank");
  }
  function JMIF_Focus( args)
  {
	var parameters = {};
	JMIF_CompleteParameters( parameters);
	parameters.entityId = args[0];
	parameters.feed = args[2];
	getMap().compute( parameters);
  }
  function JMIF_Center( args)
  {
	var parameters = {};
	JMIF_CompleteParameters( parameters);
	parameters.attributeId = args[0];
	parameters.analysisProfile = "DiscoveryProfile";
	parameters.feed = args[2];
  	getMap().compute( parameters);
  }
function JMIF_CompleteParameters( parameters) {
	 parameters.allowDomain = "*";
	 parameters.wpsserverurl = "http://server.just-map-it.com";
     parameters.feedsserverurl = "http://feeds.just-map-it.com";
	 parameters.wpsplanname = "Feeds";
	 parameters.track = "";
	 parameters.site = "";
	 parameters.readyCallback = "JMIF_ready";
	 parameters.emptyCallback = "JMIF_empty";
	 parameters.errorCallback = "JMIF_error";
	 parameters.jsessionid = "";
} 
</script>
]]>   
</Content>
</Module>