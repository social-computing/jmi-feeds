<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Just Map It! Feeds" title_url="http://feeds.just-map-it.com/" width="300" height="300" 
	  	author="Social Computing" author_email="justmapit@social-computing.com" author_link="http://www.social-computing.com"
		description="Just Map It! Feeds lets you view and navigate your feeds thru an interactive map! by Social Computing" 
		screenshot="http://feeds.just-map-it.com/images/screenshot.png" 
		thumbnail="http://feeds.just-map-it.com/images/thumbnail.png">
    <Icon>http://www.social-computing.com/favicon.ico</Icon>
    <Require feature="flash" />
    <Require feature="settitle"/>
  </ModulePrefs>
  <UserPref name="feed" display_name="Feed" datatype="string" required="true" default_value="http://www.social-computing.com/feed/"/>
  <Content type="html" view="home,profile,canvas">
<![CDATA[
<div id='wps-feeds'></div>
<script type="text/javascript" language="javascript"> 
 var prefs = new gadgets.Prefs();
 var flashvars = {};
 JMIF_CompleteParameters( flashvars);
 flashvars.analysisProfile = "GlobalProfile";
 flashvars.feed = prefs.getString( "feed");
  var parameters = gadgets.views ? gadgets.views.getParams() : null;
  if( parameters) {
    	for (var prop in parameters) {
    		flashvars[prop] = parameters[prop];
   		}
   }
   var fv='';
   for (var prop in flashvars) {
      if (fv) fv=fv+'&';
      fv=fv + prop + '=' + flashvars[prop];
   }
   var params= {
		bgcolor: "fff", allowFullScreen: "true", allowscriptaccess: "always",
        allowNetworking: "all", quality: "high", menu: "true", 
        flashvars: fv
 	};
  	gadgets.flash.embedFlash('http://feeds.just-map-it.com/client/jmi-flex-1.0-SNAPSHOT.swf', 'wps-feeds', 10, params);

  function getMap() {
  	 return document.getElementById('wps-feeds').childNodes[0];
  }
    
  function JMIF_ready() {
    var map = getMap();
    var titles = map.getArrayProperty( "$FEEDS_TITLES");
	if( map.getProperty( "$analysisProfile") == "GlobalProfile" && titles) {
		gadgets.window.setTitle( 'Just Map It! Feeds - ' + titles.join( ', '));
	}
    else {
 	 widget.setTitle( 'Just Map It! Feeds');
    }
  }
  function JMIF_empty() {
  	 gadgets.window.setTitle( 'Just Map It! Feeds');
 	 alert( "Sorry, the map is empty. Does the feed contains categories?");
  }
  function JMIF_error( error) {
  	gadgets.window.setTitle( 'Just Map It! Feeds');
   	alert( "Sorry, an error occured. Is this URL correct?");
  }
  function JMIF_Navigate( url) {
 	 window.open( url, "_blank");
  }
  function JMIF_Focus( args)
  {
	var parameters = {};
	JMIF_CompleteParameters( parameters);
	parameters.entityId = args[0];
	parameters.feed = args[2];
	getMap().compute( parameters);
  }
  function JMIF_Center( args)
  {
	var parameters = {};
	JMIF_CompleteParameters( parameters);
	parameters.attributeId = args[0];
	parameters.analysisProfile = "DiscoveryProfile";
	parameters.feed = args[2];
  	getMap().compute( parameters);
  }
function JMIF_CompleteParameters( parameters) {
	 parameters.allowDomain = "*";
	 parameters.wpsserverurl = "http://server.just-map-it.com";
     parameters.feedsserverurl = "http://feeds.just-map-it.com";
	 parameters.wpsplanname = "Feeds";
	 parameters.track = "";
	 parameters.site = "";
	 parameters.readyCallback = "JMIF_ready";
	 parameters.emptyCallback = "JMIF_empty";
	 parameters.errorCallback = "JMIF_error";
	 parameters.jsessionid = "";
} 
</script>
]]>   
</Content>
</Module>